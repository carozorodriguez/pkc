<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Campeonato Oficial 2026 | PROKART</title>

<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;500;700&display=swap" rel="stylesheet">

<style>
:root{--rojo:#e10600;--negro:#111;--gris:#f4f4f4}
body{margin:0;font-family:'Oswald',Arial;background:var(--gris)}
header{background:#000;color:#fff;text-align:center;padding:60px 20px}
section{max-width:1100px;margin:auto;padding:60px 20px}
h2{border-left:6px solid var(--rojo);padding-left:15px;margin-bottom:20px}

table{width:100%;border-collapse:collapse;background:#fff;border-radius:10px;overflow:hidden}
th,td{padding:12px;border-bottom:1px solid #ddd;text-align:center}
th{background:var(--negro);color:#fff}
td:nth-child(2){text-align:left;padding-left:15px}
tbody tr:nth-child(1){background:#ffd70033;font-weight:700}
tbody tr:nth-child(2){background:#c0c0c033}
tbody tr:nth-child(3){background:#cd7f3233}
tbody tr:hover{background:#f1f1f1}

.categoria{margin-bottom:70px}

.volver{
display:inline-block;
margin-top:30px;
background:var(--rojo);
color:#fff;
padding:12px 20px;
text-decoration:none;
border-radius:6px;
}

a{color:var(--rojo);text-decoration:none}
a:hover{text-decoration:underline}
</style>
</head>

<body>

<header>
<h1>Campeonato Oficial 2026</h1>
<p>Tabla General Acumulada</p>
</header>
  
<select id="categoriaSelectCampeonato"></select>

<div id="liderCard" class="card" style="margin-top:20px;"></div>

<table id="tablaCampeonato">
  <thead>
    <tr>
      <th>Pos</th>
      <th>Piloto</th>
      <th>Total Puntos</th>
      <th>Victorias</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<section id="contenedor"></section>

<section style="text-align:center">
<a href="index.html" class="volver">Volver al Inicio</a>
</section>

<script>

const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSGhBGHo7TZ_jtqT0HXBvYaV3g1TYBN5lEfYfq2phY0vvHTEyVkTfrVy6RrotDcqVOxm5C4JX9CdTBp/pub?gid=368482217&single=true&output=csv";

const catSel = document.getElementById("categoriaSelectCampeonato");
const tablaBody = document.querySelector("#tablaCampeonato tbody");
const liderCard = document.getElementById("liderCard");

let datos = [];

cargarDatos();

async function cargarDatos(){
  const res = await fetch(SHEET_URL);
  const csv = await res.text();

  const filas = csv.split(/\r?\n/).slice(1);

  datos = filas
    .filter(f => f.trim() !== "")
    .map(f => {
      const col = f.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g);
      if(!col) return null;

      return {
        fecha: limpiar(col[1]),
        categoria: limpiar(col[2]),
        piloto: limpiar(col[3]),
        puntos: Number(limpiar(col[4])) || 0
      };
    })
    .filter(Boolean);

  cargarCategorias();
}

function limpiar(v){
  return v?.replace(/^"|"$/g,'').trim();
}

/* ============================
   CARGAR CATEGORIAS
============================ */

function cargarCategorias(){
  const categorias = [...new Set(datos.map(d=>d.categoria))];

  categorias.forEach(c=>{
    const o = document.createElement("option");
    o.value = c;
    o.textContent = c;
    catSel.appendChild(o);
  });

  catSel.onchange = actualizarCampeonato;

  actualizarCampeonato();
}

/* ============================
   ACTUALIZAR CAMPEONATO
============================ */

function actualizarCampeonato(){

  const categoriaActual = catSel.value;

  const datosCat = datos.filter(d=>d.categoria===categoriaActual);

  const mapa = {};
const victorias = {};

// Detectar ganadores por fecha
const fechas = [...new Set(datosCat.map(d=>d.fecha))];

fechas.forEach(f=>{
  const fechaDatos = datosCat.filter(d=>d.fecha===f);
  const maxPuntos = Math.max(...fechaDatos.map(d=>d.puntos));

  fechaDatos.forEach(d=>{
    if(d.puntos === maxPuntos){
      victorias[d.piloto] = (victorias[d.piloto] || 0) + 1;
    }
  });
});

  // Sumar puntos totales
  datosCat.forEach(d=>{
    mapa[d.piloto] = (mapa[d.piloto] || 0) + d.puntos;
  });

  const ranking = Object.entries(mapa)
    .sort((a,b)=>b[1]-a[1]);

  // LIMPIAR
  tablaBody.innerHTML = "";
  liderCard.innerHTML = "";

  if(ranking.length === 0) return;

  // ü•á LIDER
  const lider = ranking[0];

  liderCard.innerHTML = `
    <div style="display:flex;align-items:center;gap:20px;flex-wrap:wrap;">
      <img src="pilotos/${lider[0].replaceAll(" ","_")}.jpg"
           onerror="this.src='pilotos/default.jpg'"
           style="width:160px;border-radius:12px">
      <div>
        <h2 style="margin:0;color:#e10600;">ü•á L√çDER DEL CAMPEONATO</h2>
        <h3 style="margin:5px 0">${lider[0]}</h3>
        <p style="font-size:18px;font-weight:bold">${lider[1]} puntos</p>
        <p>${categoriaActual}</p>
      </div>
    </div>
  `;

  // TABLA
  ranking.forEach(([piloto, total],i)=>{
  tablaBody.innerHTML += `
    <tr>
      <td>${i+1}</td>
      <td>
        <a href="piloto.html?piloto=${encodeURIComponent(piloto)}&categoria=${encodeURIComponent(categoriaActual)}">
          ${piloto}
        </a>
      </td>
      <td>${total}</td>
      <td>${victorias[piloto] || 0}</td>
    </tr>
  `;
});


</script>


</body>
</html>
