<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Resultados por Fecha | PROKART</title>

<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;500;700&display=swap" rel="stylesheet">

<style>
:root{--rojo:#e10600;--negro:#111;--gris:#f4f4f4}
body{margin:0;font-family:'Oswald',Arial;background:var(--gris)}
header{background:#000;color:#fff;text-align:center;padding:50px 20px}
section{max-width:1100px;margin:auto;padding:50px 20px}
h2{border-left:6px solid var(--rojo);padding-left:15px}
table{width:100%;border-collapse:collapse;margin-top:20px;background:#fff}
th,td{padding:12px;border-bottom:1px solid #ddd;text-align:center}
th{background:#111;color:#fff}
td:nth-child(2){text-align:left;padding-left:15px}
a{color:#e10600;text-decoration:none}
a:hover{text-decoration:underline}
.categoria{margin-bottom:60px}
.volver{
display:inline-block;
margin-top:30px;
background:var(--rojo);
color:#fff;
padding:12px 20px;
text-decoration:none;
border-radius:6px;
}
</style>
</head>

<body>

<header>
<h1 id="tituloFecha"></h1>
</header>

<section id="contenedor"></section>

<section style="text-align:center">
<a href="index.html" class="volver">Volver al Inicio</a>
</section>

<script>

const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSGhBGHo7TZ_jtqT0HXBvYaV3g1TYBN5lEfYfq2phY0vvHTEyVkTfrVy6RrotDcqVOxm5C4JX9CdTBp/pub?gid=368482217&single=true&output=csv";

const params = new URLSearchParams(window.location.search);
const fechaSeleccionada = params.get("fecha");

document.getElementById("tituloFecha").textContent = "Resultados - " + fechaSeleccionada;

async function cargar(){

const response = await fetch(SHEET_URL);
const csv = await response.text();

const filas = csv.split(/\r?\n/).slice(1);

const datos = filas
.filter(f=>f.trim()!=="")
.map(f=>{
const c = f.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g);
if(!c) return null;

return {
fecha: limpiar(c[1]),
categoria: limpiar(c[2]),
piloto: limpiar(c[3]),
puntos: Number(limpiar(c[4])) || 0
};
})
.filter(Boolean)
.filter(d=>d.fecha===fechaSeleccionada);

mostrar(datos);
}

function limpiar(v){
return v?.replace(/^"|"$/g,'').trim();
}

function mostrar(datos){

const cont = document.getElementById("contenedor");

if(datos.length===0){
cont.innerHTML = "<p>No hay resultados cargados para esta fecha.</p>";
return;
}

const categorias = [...new Set(datos.map(d=>d.categoria))];

categorias.forEach(cat=>{

const datosCat = datos
.filter(d=>d.categoria===cat)
.sort((a,b)=>b.puntos-a.puntos);

let html = `
<div class="categoria">
<h2>${cat}</h2>
<table>
<thead>
<tr>
<th>Puesto</th>
<th>Piloto</th>
<th>Puntos</th>
</tr>
</thead>
<tbody>
`;

datosCat.forEach((d,i)=>{
html += `
<tr>
<td>${i+1}</td>
<td>
<a href="piloto.html?piloto=${encodeURIComponent(d.piloto)}&categoria=${encodeURIComponent(cat)}">
${d.piloto}
</a>
</td>
<td>${d.puntos}</td>
</tr>
`;
});

html += `</tbody></table></div>`;

cont.innerHTML += html;

});
}

cargar();

</script>

</body>
</html>
